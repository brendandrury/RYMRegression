var c=(e,r,t)=>new Promise((a,o)=>{var i=s=>{try{l(t.next(s))}catch(u){o(u)}},n=s=>{try{l(t.throw(s))}catch(u){o(u)}},l=s=>s.done?a(s.value):Promise.resolve(s.value).then(i,n);l((t=t.apply(e,r)).next())});var RYMbrowser={path:{},resultCache:{},currentResultSet:{},initialized:{},lastAjaxRequest:null,lastSearchValue:null,lastSearchTimer:null,blurTimer:{},searchEndpoint:"/api/1/browse/",_rootEl:function(e){var r=e.data("id");return $("#ui_browser_"+r)},_inputEl:function(e){var r=e.data("id");return $("#ui_browser_input_"+r)},_renderSearchNavigation:function(e){return c(this,null,function*(){var r=RYMbrowser.path[e],t=$("#ui_browser_input_frame_"+e),a=$("#ui_browser_navigation_outer_"+e);r.length==0?(a.html(""),t[0].className="ui_browser_input_frame"):(a.html(yield renderTemplate("ui.browser.navigation",{nav_history:r,id:e})),t[0].className="ui_browser_input_frame has_nav")})},onClickResetNavigation:function(e){RYMbrowser.path[e]=[],RYMbrowser._renderSearchNavigation(e),$("#ui_browser_input_"+e).focus()},onClickNavigationBar:function(e){RYMbrowser.setDialogActive(e,!0),$("#ui_browser_list_"+e).show()},onNavigate:function(e,r){var t=[];for(var a in RYMbrowser.path[e])if(t.push(RYMbrowser.path[e][a]),RYMbrowser.path[e][a].path===r){RYMbrowser.path[e]=t,RYMbrowser._renderSearchNavigation(e),RYMbrowser.loadPath(e,r);return}},_update:function(e){},setDialogActive:function(e,r){RYMbrowser.stopBodyScrolling(!r),r?(RYMbrowser.lastBodyYOffset=document.body.scrollTop,$("#ui_browser_outer_"+e).addClass("active")[0].scrollTop=0,$("#overlay_invisible").show().on("click",function(){RYMbrowser.setDialogActive(e,!1)}),$("#ui_browser_list_overlay").show().on("click",function(){RYMbrowser.onClickMobileClose(e)}),document.body.scrollTop=0):($("#overlay_invisible").hide().off("click"),document.body.scrollTop=RYMbrowser.lastBodyYOffset,$("#ui_browser_outer_"+e).removeClass("active"),$("#ui_browser_list_overlay").hide().off("click"),RYMbrowser.hideResults(e))},_freezeVp:function(e){e.preventDefault()},stopBodyScrolling:function(e){e===!0?document.body.addEventListener("touchmove",RYMbrowser._freezeVp,!1):document.body.removeEventListener("touchmove",RYMbrowser._freezeVp,!1)},_updateClearButtonState:function(e){var r=$("#ui_browser_input_"+e),t=r.val();t.length==0?$("#ui_browser_input_frame_search_"+e)[0].className="ui_browser_input_frame_search":$("#ui_browser_input_frame_search_"+e)[0].className="ui_browser_input_frame_search has_data"},onInputFocus:function(e,r){var t=r.data("id");RYMbrowser.setDialogActive(t,!0),RYMbrowser.initialized[t]||(RYMbrowser.initialized[t]=!0,RYMbrowser._update(t)),RYMbrowser.blurTimer[t]&&clearTimeout(RYMbrowser.blurTimer[t]),RYMbrowser.onInputKeyUp(e,r)},onInputBlur:function(e,r){var t=r.data("id");RYMbrowser._rootEl(r)[0].className="ui_browser",RYMbrowser.blurTimer[t]&&clearTimeout(RYMbrowser.blurTimer[t]),window.matchMedia&&window.matchMedia("(max-width:48em)").matches},hideResults:function(e){$("#ui_browser_list_"+e).hide()},onInputKeyUp:function(e,r){var t=r.data("id"),a=RYMbrowser._inputEl(r);RYMbrowser.lastSearchTimer&&(clearTimeout(RYMbrowser.lastSearchTimer),RYMbrowser.lastSearchTimer=null);var o=a.val();o=o.trim(),RYMbrowser._updateClearButtonState(t),RYMbrowser.search(t,o)},search:function(e,r){RYMbrowser.lastSearchTimer&&(clearTimeout(RYMbrowser.lastSearchTimer),RYMbrowser.lastSearchTimer=null),RYMbrowser.lastSearchTimer=setTimeout(function(){RYMbrowser._doSearch(e,r)},50)},loadPath:function(e,r){RYMbrowser.lastSearchTimer&&(clearTimeout(RYMbrowser.lastSearchTimer),RYMbrowser.lastSearchTimer=null),RYMbrowser.lastSearchTimer=setTimeout(function(){RYMbrowser._doLoadPath(e,r)},50)},_doLoadPath:function(e,r){if(RYMbrowser.lastAjaxRequest){try{RYMbrowser.lastAjaxRequest.abort()}catch(i){}RYMbrowser.lastAjaxRequest=null}var t={path:r},a=JSON.stringify(t);if(RYMbrowser.resultCache[a]){RYMbrowser._onResults(e,RYMbrowser.resultCache[a]);return}var o=$("#ui_browser_"+e).data("scope");RYMbrowser.lastAjaxRequest=$.ajax({url:RYMbrowser.searchEndpoint+o+"/"+r,data:{},dataType:"json"}).done(function(i){RYMbrowser.resultCache[a]=i,RYMbrowser.currentResultSet[e]=i,RYMbrowser._onResults(e,i)}),console.log("RYMbrowser: loading path for "+r)},_onResults:function(e,r){return c(this,null,function*(){var t="";for(result in r.results){var a=r.results[result];a.id=e,t+=yield renderTemplate("ui.browser.item",a)}r.results.length&&($("#ui_browser_list_"+e).show()[0].scrollTop=0),$("#ui_browser_list_contents_"+e).html(t).show()})},_doSearch:function(e,r){if(RYMbrowser.lastAjaxRequest){try{RYMbrowser.lastAjaxRequest.abort()}catch(i){}RYMbrowser.lastAjaxRequest=null}var t={q:r},a=JSON.stringify(t);if(RYMbrowser.resultCache[a]){RYMbrowser._onResults(e,RYMbrowser.resultCache[a]);return}var o=$("#ui_browser_"+e).data("scope");RYMbrowser.lastAjaxRequest=$.ajax({url:RYMbrowser.searchEndpoint+o+"/",data:t,dataType:"json"}).done(function(i){RYMbrowser.resultCache[a]=i,RYMbrowser.currentResultSet[e]=i,RYMbrowser._onResults(e,i)}),console.log("RYMbrowser: searching for "+r)},onClickMobileClose:function(e){RYMbrowser.setDialogActive(e,!1),$("#ui_browser_list_overlay").hide().off("click")},onClickClear:function(e){$("#ui_browser_input_"+e).val("").focus(),RYMbrowser._updateClearButtonState(e)},onClickItem:function(e,r,t,a,o){var i=o?"_include":"_exclude";switch(e){case"genre":$("#ui_browser_list_item_button_sections_"+e+"_"+t+"_"+a)[0].className="ui_browser_list_item_button_sections in_menu in_genre"+i;break;case"descriptor":o?RYMbrowser.addBrowserItem(a,"descriptor_include",t,r):RYMbrowser.addBrowserItem(a,"descriptor_exclude",t,r),RYMbrowser.setDialogActive(a,!1);break;case"location":$("#ui_browser_list_item_button_sections_"+e+"_"+t+"_"+a)[0].className="ui_browser_list_item_button_sections in_menu in_location"+i;break;case"language":o?RYMbrowser.addBrowserItem(a,"language_include",t,r):RYMbrowser.addBrowserItem(a,"language_exclude",t,r),RYMbrowser.setDialogActive(a,!1);break}},onClickItemBack:function(e,r,t){$("#ui_browser_list_item_button_sections_"+e+"_"+r+"_"+t)[0].className="ui_browser_list_item_button_sections"},onClickItemGenrePrimary:function(e,r,t,a){a?RYMbrowser.addBrowserItem(t,"genre_include",r,e):RYMbrowser.addBrowserItem(t,"genre_exclude",r,e),RYMbrowser.setDialogActive(t,!1)},onClickItemGenreInfluence:function(e,r,t,a){a?RYMbrowser.addBrowserItem(t,"sec_genre_include",r,e):RYMbrowser.addBrowserItem(t,"sec_genre_exclude",r,e),RYMbrowser.setDialogActive(t,!1)},onClickItemGenreEither:function(e,r,t,a){a?RYMbrowser.addBrowserItem(t,"genre_either_include",r,e):RYMbrowser.addBrowserItem(t,"genre_either_exclude",r,e),RYMbrowser.setDialogActive(t,!1)},onClickItemLocationArtist:function(e,r,t,a){a?RYMbrowser.addBrowserItem(t,"artist_location_include",r,e):RYMbrowser.addBrowserItem(t,"artist_location_exclude",r,e),RYMbrowser.setDialogActive(t,!1)},onClickItemLocationUsers:function(e,r,t,a){a?RYMbrowser.addBrowserItem(t,"user_location_include",r,e):RYMbrowser.addBrowserItem(t,"user_location_exclude",r,e),RYMbrowser.setDialogActive(t,!1)},onClickItemBrowseFurther:function(e,r,t,a,o){typeof RYMbrowser.path[t]=="undefined"&&(RYMbrowser.path[t]=[]);var i={component:e,name:a,path:o};for(var n in RYMbrowser.path[t])if(RYMbrowser.path[t][n].path===o)return;RYMbrowser.path[t].push(i),RYMbrowser._renderSearchNavigation(t),RYMbrowser.loadPath(t,o)},addBrowserItem:function(e,r,t,a){RYMchart.addBrowserItem(r,t,a),RYMbrowser.path[e]=[],RYMbrowser._renderSearchNavigation(e),$("#ui_browser_input_"+e).val("")}};
