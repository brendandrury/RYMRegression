var p=(e,t,_)=>new Promise((a,s)=>{var l=n=>{try{c(_.next(n))}catch(i){s(i)}},r=n=>{try{c(_.throw(n))}catch(i){s(i)}},c=n=>n.done?a(n.value):Promise.resolve(n.value).then(l,r);c((_=_.apply(e,t)).next())});var RYMchart={state:window.RYMchartDefaultState||{},stateIsDirty:!1,_isChecked:function(e){return $("#"+e).is(":checked")},getBlankState:function(e){var t={}},onClickCreateChart:function(){$("#page_chart_query_error").hide(),$.ajax({url:"/api/1/chart/url/",data:{chart:JSON.stringify(RYMchart.state)},type:"POST",dataType:"json",async:!0}).done(function(e){e.status==="success"?window.location=e.url:RYMchart.showErrors(e.errors)})},showErrors:function(e){var t="";for(var _ in e)t+="<p>"+e[_]+"</p>";$("#page_chart_query_error").html(t).show()},initWithState:function(e){$("#page_chart_query")[0].reset(),RYMchart._isChecked("page_chart_query_advanced_users_other")&&$("#page_chart_query").addClass("show_option_users_list"),RYMchart.selectDateRange(e.start_date,e.end_date),RYMchart.selectPopularityWeight(e.pop_weight),RYMchart._updateFrameClass(),$(".release_type_btn").removeClass("selected");for(var t in e.release_types)$("#release_type_btn_"+e.release_types[t]).addClass("selected");$("#page_chart_query_create_btn").addClass("disabled").prop("aria-disabled",!0)},_updateStateDebug:function(){},_updateFrameClass:function(e){var t=["page_chart_query"];$("#page_chart_query").removeClass(function(_,a){return(a.match(/(^|\s)chart_type\S+/g)||[]).join(" ")}),$("#page_chart_query").removeClass(function(_,a){return(a.match(/(^|\s)object_\S+/g)||[]).join(" ")}),$("#page_chart_query").removeClass(function(_,a){return(a.match(/(^|\s)date_type_\S+/g)||[]).join(" ")}),$("#page_chart_query").addClass("chart_type_"+RYMchart.state.chart_type),$("#page_chart_query").addClass("object_"+RYMchart.state.chart_object),$("#page_chart_query").addClass("date_type_"+RYMchart.state.chart_date_range_type),RYMchart.markDirty(),RYMchart._updateStateDebug()},openChartTypeSelect:function(){$(".chart_ui_filter_list").hide(),$("#overlay_invisible").show().on("click",function(){RYMchart.closeChartTypeSelect()}),$("#page_chart_query_item_type_select").show()},closeChartTypeSelect:function(){$(".chart_ui_filter_list").hide(),$("#overlay_invisible").unbind().hide(),$("#page_chart_query_item_type_select").hide()},onClickChartType:function(e,t){$("#page_chart_query_item_chart_type_title").text(t.data("description")),RYMchart.state.chart_type=t.data("value"),RYMchart._updateFrameClass(),RYMchart.closeChartTypeSelect(),RYMchart.markDirty()},openObjectTypeSelect:function(){$(".chart_ui_filter_list").hide(),$("#overlay_invisible").show().on("click",function(){RYMchart.closeObjectTypeSelect()}),$("#page_chart_query_item_chart_object_select").show()},closeObjectTypeSelect:function(){$(".chart_ui_filter_list").hide(),$("#overlay_invisible").unbind().hide(),$("#page_chart_query_item_chart_object_select").hide()},onClickObjectType:function(e,t){var _=RYMchart.state.chart_object;if(RYMchart.state.chart_object=t.data("value"),RYMchart.state.chart_object==="game"){window.location="https://glitchwave.com/charts/";return}if(_==="film"&&RYMchart.state.chart_object==="release"){window.location="/charts/";return}if(_==="release"&&RYMchart.state.chart_object==="film"){window.location="/charts/top/film/all-time/";return}RYMchart._updateFrameClass(),t.data("value")!=="release"?($("#page_chart_query_item_chart_object_title").text(t.data("description")),RYMchart.closeObjectTypeSelect()):RYMchart._updateReleaseTypeValue(),RYMchart.markDirty()},openDateSelect:function(){$(".chart_ui_filter_list").hide(),$("#overlay_invisible").show().on("click",function(){RYMchart.closeDateSelect()}),$("#page_chart_query_item_date_select").show()},closeDateSelect:function(){$(".chart_ui_filter_list").hide(),$("#overlay_invisible").unbind().hide(),$("#page_chart_query_item_date_select").hide()},onClickDateType:function(e,t){RYMchart.in_date_selection=!1,RYMchart.state.chart_date_range_type=t.data("value"),RYMchart._updateFrameClass(),t.data("value")==="all_time"&&($("#page_chart_query_item_chart_date_type_title").text(t.data("description")),RYMchart.state.start_date=18e6,RYMchart.state.end_date=20999999,RYMchart._updateStateDebug(),RYMchart.closeDateSelect(),RYMchart.markDirty())},markDirty:function(){$("#page_chart_query_create_btn").removeClass("disabled").prop("aria-disabled",!1)},refreshChart:function(){},_getReleaseTypeLabelText:function(e){var t=JSON.parse(e),_={album:"Albums",ep:"EPs",comp:"Compilations",single:"Singles",video:"Videos",unauth:"Unauth/Bootlegs",mixtape:"Mixtapes",djmix:"DJ mixes"},a=[];for(var s in t)a.push(_[t[s]]);return a.length==1?a[0]:a.length==2?a[0]+" and "+a[1]:a.length==3?a[0]+", "+a[1]+", and "+a[2]:a.length==8?"Releases (all)":a.length==0?"Releases":a[0]+", "+a[1]+", "+a[2]+" (+"+(a.length-3)+")"},_updateReleaseTypeValue:function(){var e=$(".release_type_btn.selected"),t=[];for(var _ in e)e[_].dataset&&e[_].dataset.val&&t.push(e[_].dataset.val);t=t.sort(function(s,l){var r=["album","ep","comp","single","video","unauth","mixtape","djmix"];return r.indexOf(s)-r.indexOf(l)});var a=JSON.stringify(t);$(".chart_release_all_none_btn").removeClass("selected"),a=='["album"]'?$("#chart_release_all_none_btn_albums").addClass("selected"):a=='["album","ep","mixtape","djmix"]'?$("#chart_release_all_none_btn_main").addClass("selected"):a=='["single"]'?$("#chart_release_all_none_btn_singles").addClass("selected"):a=="[]"?$("#chart_release_all_none_btn_clear").addClass("selected"):a=='["album","ep","comp","single","video","unauth","mixtape","djmix"]'&&$("#chart_release_all_none_btn_all").addClass("selected"),$("#page_chart_query_item_chart_object_title").html(RYMchart._getReleaseTypeLabelText(a)),RYMchart.state.release_types=t,RYMchart.markDirty(),RYMchart._updateStateDebug()},selectReleaseTypeNone:function(e){$(".release_type_btn").removeClass("selected"),RYMchart._updateReleaseTypeValue()},selectReleaseTypeAll:function(e){$(".release_type_btn").addClass("selected"),RYMchart._updateReleaseTypeValue()},selectReleaseTypeMain:function(e){$(".release_type_btn").removeClass("selected"),$("#release_type_btn_album").addClass("selected"),$("#release_type_btn_ep").addClass("selected"),$("#release_type_btn_single").addClass("selected"),$("#release_type_btn_mixtape").addClass("selected"),RYMchart._updateReleaseTypeValue()},selectReleaseTypeAlbums:function(e){$(".release_type_btn").removeClass("selected"),$("#release_type_btn_album").addClass("selected"),RYMchart._updateReleaseTypeValue()},selectReleaseTypeSingles:function(e){$(".release_type_btn").removeClass("selected"),$("#release_type_btn_single").addClass("selected"),RYMchart._updateReleaseTypeValue()},selectDateRange:function(e,t){if(e>t){var _=t;t=e/1e4,e=_/1e4+9999}t>20999999&&(t=20999999),e<18e6&&(e=18e6);var a=parseInt(e/1e4),s=parseInt(t/1e4),l;if(a===s?l=a:e==18e6&&t>=20999999?l="All-time":a%10==0&&s-a==9?l=a+"s":l=a+" - "+s,$("#page_chart_query_item_chart_date_type_title").text(l),RYMchart.start_year=a,RYMchart.end_year=s,$(".date_year_chooser_decade_btn").removeClass("selected"),$(".date_year_chooser_year_btn").removeClass("selected"),RYMchart.state.start_date=e,RYMchart.state.end_date=t,e==18e6&&t>=20999999){$(".date_range_btn").removeClass("selected"),$("#date_range_all_time").addClass("selected"),$("#chart_date_custom").hide();return}else e%1e4==0&&t%1e4==9999?($(".date_range_btn").removeClass("selected"),$("#date_range_range").addClass("selected"),$("#chart_date_custom").hide()):($("#chart_date_custom").show(),RYMchart.selectCustomRange(e,t),$(".date_range_btn").removeClass("selected"),$("#date_range_custom").addClass("selected"));for(var r=a;r<=s;r++)$("#date_year_chooser_year_"+r).addClass("selected"),r%10==0&&s>=r+9?$("#date_year_chooser_decade_"+r).addClass("selected"):r==2020&&s==2021&&$("#date_year_chooser_decade_2020").addClass("selected");e<1950&&($("#date_year_chooser_extra").show(),$("#date_year_chooser_toggle").show(),$("#date_year_toggle_icon")[0].className="fa fa-caret-up"),RYMchart._updateStateDebug(),RYMchart.markDirty()},_date_pad:function(e){return e.length==1?"0"+e:e},selectCustomRange:function(e,t){var _=[null,"jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],a=Math.floor(e/1e4),s=Math.floor(e%1e4/100),l=Math.floor(e%100),r=Math.floor(t/1e4),c=Math.floor(t%1e4/100),n=Math.floor(t%100),i="",o="",d="",u="";l!=0?(o=l+" "+_[s]+" "+a,i=a+"-"+RYMchart._date_pad(s)+"-"+RYMchart._date_pad(l)+".a.0."):s!=0?(o=_[s]+" "+a,i=a+"-"+RYMchart._date_pad(s)+"-01.b.0."):(o=a,i=a+"-01-01.c.0."),n!=99?(d=n+" "+_[c]+" "+r,u=r+"-"+RYMchart._date_pad(c)+"-"+RYMchart._date_pad(n)+".a"):c!=99?(d=_[c]+" "+r,u=r+"-"+RYMchart._date_pad(c)+"-01.b"):(d=r,u=r+"-01-01.c"),d!=o&&(o+="-"+d),i+=u,$("#chart_custom_date_range_text").val(o),$("#chart_custom_date_range").val(JSON.stringify(new Array(i)))},toggleReleaseType:function(e){var t=$("#release_type_btn_"+e);t.toggleClass("selected");var _=$("#release_types");RYMchart._updateReleaseTypeValue()},onMouseUpDateChooserDecade:function(e,t){},onMouseDownDateChooserDecade:function(e,t){window.event&&RYMchart.in_date_selection?(RYMchart.in_date_selection=!1,t<RYMchart.temp_start_year?RYMchart.selectDateRange(t*1e4,RYMchart.temp_end_year*1e4+9999):t>RYMchart.temp_end_year?RYMchart.selectDateRange(RYMchart.temp_start_year*1e4,(t+9)*1e4+9999):RYMchart.selectDateRange(RYMchart.temp_start_year*1e4,RYMchart.temp_end_year*1e4+9999)):(RYMchart.selectDateRange(t*1e4,(t+9)*1e4+9999),RYMchart.temp_start_year=t,RYMchart.temp_end_year=t+9,RYMchart.state.chart_date_range_type==="year_range"&&(RYMchart.in_date_selection=!0))},onMouseOverDateChooserDecade:function(e,t){},onMouseUpDateChooserYear:function(e,t){},onMouseDownDateChooserYear:function(e,t){window.event&&RYMchart.in_date_selection?(RYMchart.in_date_selection=!1,t<RYMchart.temp_start_year?RYMchart.selectDateRange(t*1e4,RYMchart.temp_end_year*1e4+9999):t>RYMchart.temp_end_year&&RYMchart.selectDateRange(RYMchart.temp_start_year*1e4,t*1e4+9999)):(RYMchart.temp_start_year=t,RYMchart.temp_end_year=t,RYMchart.selectDateRange(t*1e4,t*1e4+9999),RYMchart.state.chart_date_range_type==="year_range"&&(RYMchart.in_date_selection=!0))},onMouseOverDateChooserYear:function(e,t){},selectPopularityWeight:function(e){$(".chart_pop_label_choice").removeClass("selected"),$("#chart_pop_"+e).addClass("selected"),RYMchart.state.pop_weight=e,RYMchart._updateStateDebug(),RYMchart.markDirty()},onClickShowAdvancedOptions:function(){$("#page_chart_query").addClass("show_all_advanced"),localStorage.setItem("chart.build.expanded","show")},onClickHideAdvancedOptions:function(){confirm("This will reset all advanced options to default. Are you sure?")&&($("#page_chart_query").removeClass("show_all_advanced"),localStorage.setItem("chart.build.expanded","hide"))},_updateStateOnCheck:function(e,t){var _=RYMchart._isChecked(e);RYMchart.state[t]=_,RYMchart._updateStateDebug(),RYMchart.markDirty()},addBrowserItem:function(e,t,_){return p(this,null,function*(){var a=RYMchart.state[e];for(var s in a)if(a[s].id===t)return;RYMchart.state[e].push({id:t,name:_}),$("#page_chart_query_free_section_items_"+e).html(yield renderTemplate("ui.chart.build.browseritems",{item:e,items:RYMchart.state[e]})),RYMchart.state[e].length>1?$("#page_chart_query_free_section_"+e)[0].className="page_chart_query_free_section has_items has_multiple_items":$("#page_chart_query_free_section_"+e)[0].className="page_chart_query_free_section has_items",RYMchart.markDirty()})},removeBrowserItem:function(e,t){var _=RYMchart.state[e],a=[];for(var s in _)_[s].id!=t&&a.push(_[s]);RYMchart.state[e]=a,$("#page_chart_query_item_"+e+"_"+t).remove(),RYMchart.state[e].length==0?$("#page_chart_query_free_section_"+e)[0].className="page_chart_query_free_section":RYMchart.state[e].length>1?$("#page_chart_query_free_section_"+e)[0].className="page_chart_query_free_section has_items has_multiple_items":$("#page_chart_query_free_section_"+e)[0].className="page_chart_query_free_section has_items",RYMchart.markDirty()},onClickBrowserItemAll:function(e){RYMchart._updateStateOnCheck("page_chart_query_free_section_"+e+"_all",e+"_all")},onClickBrowserItemSub:function(e){RYMchart._updateStateOnCheck("page_chart_query_free_section_"+e+"_sub_items",e+"_children")},onClickUsersFollowing:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_users_following","users_following")},onClickUsersFollowers:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_users_followers","users_followers")},onClickExcludeCatRatings:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_exclude_label_ratings","cat_exclude_ratings")},onClickExcludeCatCatalog:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_exclude_label_catalog","cat_exclude_catalog")},onClickExcludeCatWishlist:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_exclude_label_wishlist","cat_exclude_wishlist")},onClickIncludeLive:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_include_live","include_live")},onClickIncludeArchival:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_include_archival","include_archival")},onClickIncludeExcludeOther:function(){RYMchart._updateStateOnCheck("page_chart_query_advanced_include_exclude_other","exclude_other")},onClickUsersOther:function(){var e=RYMchart._isChecked("page_chart_query_advanced_users_other");e?($("#page_chart_query").addClass("show_option_users_list"),RYMchart.updateOtherUsers()):(RYMchart.state.users_urls=[],$("#page_chart_query").removeClass("show_option_users_list")),RYMchart.markDirty()},updateOtherUsers:function(){var e=$("#page_chart_query_advanced_users_list").val(),t=[],_=e.split(",");for(var a in _)t.push(_[a].trim());RYMchart.state.users_urls=t,RYMchart.markDirty()},_updateNumberOnChange:function(e,t){var _=parseInt($("#"+e).val());typeof _=="number"&&_?RYMchart.state[t]=_:RYMchart.state[t]=0,RYMchart._updateStateDebug(),RYMchart.markDirty()},onChangeRatingsMin:function(){RYMchart._updateNumberOnChange("page_chart_query_input_ratings_min","min_ratings")},onChangeRatingsMax:function(){RYMchart._updateNumberOnChange("page_chart_query_input_ratings_max","max_ratings")},onChangeAgeMin:function(){RYMchart._updateNumberOnChange("page_chart_query_input_user_age_min","min_user_age")},onChangeAgeMax:function(){RYMchart._updateNumberOnChange("page_chart_query_input_user_age_max","max_user_age")},onClickVersionDaily:function(){RYMchart.state.chart_version="daily",RYMchart.markDirty()},onClickVersionWeekly:function(){RYMchart.state.chart_version="weekly",RYMchart.markDirty()}};
